/*!
 * Copyright 2016 Thinking Bytes Ltd.
 *
 * ngChatScroller, v0.2.0
 * Smooth Chat based scrolling for Angular.
 * http://angularjs.org/
 *
 * By @arolave <3
 *
 * Licensed under the MIT license. Please see LICENSE for more information.
 *
 */

!function(){"use strict";function t(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,r){for(var l=0;l<r.length;l++){var e=r[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(r,l,e){return l&&t(r.prototype,l),e&&t(r,e),r}}();ngcsUtils={size:function(t){return t?t.length:0},last:function(t){return t?t[t.length-1]:void 0}};var l=function(){function l(r,e){t(this,l),this.scrollView=r,this.$log=e}return r(l,[{key:"startScrollBottom",value:function(){}},{key:"doScrollBottom",value:function(){this.scrollView.scrollTop=this.scrollView.scrollHeight}},{key:"startMaintainScroll",value:function(){return this.startScrollTopMax=this.scrollView.scrollTop,this.startScrollTopMax}},{key:"doMaintainScroll",value:function(){var t=this.scrollView.scrollHeight-this.startScrollHeight;return this.scrollView.scrollTop=this.startScrollTopMax+t}},{key:"startScroll",value:function(t,r){var l=this,e=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=function(r,e){var n=Math.abs(l.scrollView.scrollHeight-l.startScrollHeight);return n!==r?(l["do"+t](),o(n,0)):4>=e||!l.endCurrentScroll?o(r,e+1):l["do"+t]()},o=function(t,r){return setTimeout(function(){return n(t,r)})};return this.scrollType=t,this.endCurrentScroll=e,this.shouldAnimate=r,this.startScrollHeight=this.scrollView.scrollHeight,this.startScrollTime=Date.now(),this["start"+t](),this["do"+t](),n(0,0)}},{key:"stopCurrentScroll",value:function(){return this["do"+this.scrollType](),this.endCurrentScroll=!0}}]),l}(),e=function(){function e(r,n,o,s){t(this,e),this.$log=s,this.chatScroller=new l(n[0],s),this.messages=null,r.ngcsNumRendered=r.ngcsLimit=0,this.watches(r,o.chatScrollView)}return r(e,[{key:"watches",value:function(t,r){var l=this;t.$watchCollection(r,function(r){null!==r&&ngcsUtils.size(r)!==t.ngcsLimit&&(ngcsUtils.last(l.messages)===ngcsUtils.last(r)?l.chatScroller.startScroll("MaintainScroll",!1):l.chatScroller.startScroll("ScrollBottom",t.ngcsNumRendered>0),l.messages=r,t.ngcsLimit=ngcsUtils.size(r))})}}]),e}();e.$inject=["$scope","$element","$attrs","$log"],angular.module("ngChatScroller",[]).directive("chatScrollView",["$log",function(t){return{restrict:"A",controller:e,link:function(t,r,l,e){var n=l.ngcsMessageSelector?l.ngcsMessageSelector:".chat-message";return t.$watch(function(){return r[0].querySelectorAll(n).length},function(r,l){r>0&&t.$evalAsync(function(){t.ngcsLimit===r&&(t.ngcsNumRendered=r,e.chatScroller.stopCurrentScroll())})})}}}])}();