/*!
 * Copyright 2016 Thinking Bytes Ltd.
 *
 * ngChatScroller, v0.1.0
 * Smooth Chat based scrolling for Angular.
 * http://angularjs.org/
 *
 * By @arolave <3
 *
 * Licensed under the MIT license. Please see LICENSE for more information.
 *
 */

!function(){"use strict";function t(t,r){if(!(t instanceof r))throw new TypeError("Cannot call a class as a function")}var r=function(){function t(t,r){for(var l=0;l<r.length;l++){var e=r[l];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}return function(r,l,e){return l&&t(r.prototype,l),e&&t(r,e),r}}(),l=function(){function l(r,e){t(this,l),this.scrollView=r,this.$log=e}return r(l,[{key:"startScrollBottom",value:function(){}},{key:"doScrollBottom",value:function(){this.scrollView.scrollTop=this.scrollView.scrollHeight}},{key:"startMaintainScroll",value:function(){return this.startScrollTopMax=this.scrollView.scrollTop,this.startScrollTopMax}},{key:"doMaintainScroll",value:function(){var t=this.scrollView.scrollHeight-this.startScrollHeight;return this.scrollView.scrollTop=this.startScrollTopMax+t}},{key:"startScroll",value:function(t,r){var l=this,e=arguments.length<=2||void 0===arguments[2]?!1:arguments[2],n=function(r,e){var n=Math.abs(l.scrollView.scrollHeight-l.startScrollHeight);return n!==r?(l["do"+t](),o(n,0)):4>=e||!l.endCurrentScroll?o(r,e+1):l["do"+t]()},o=function(t,r){return setTimeout(function(){return n(t,r)})};return this.scrollType=t,this.endCurrentScroll=e,this.shouldAnimate=r,this.startScrollHeight=this.scrollView.scrollHeight,this.startScrollTime=Date.now(),this["start"+t](),this["do"+t](),n(0,0)}},{key:"stopCurrentScroll",value:function(){return this["do"+this.scrollType](),this.endCurrentScroll=!0}}]),l}();utils={size:function(t){return t?t.length:0},last:function(t){return t?t[t.length-1]:void 0}},angular.module("ngChatScroller",[]).directive("chatScrollView",["$log",function(t){return{restrict:"A",controller:["$scope","$element","$attrs",function(r,e,n){(void 0).init=function(){(void 0).chatScroller=new l(e[0],t),(void 0).messages=null,r.ngcsNumRendered=r.ngcsLimit=0},r.$watchCollection(n.chatScrollView,function(t){null!==t&&utils.size(t)!==r.ngcsLimit&&(utils.last((void 0).messages)===utils.last(t)?(void 0).chatScroller.startScroll("MaintainScroll",!1):(void 0).chatScroller.startScroll("ScrollBottom",r.ngcsNumRendered>0),(void 0).messages=t,r.ngcsLimit=utils.size(t))}),(void 0).init()}],link:function(t,r,l){var e=l.ngcsMessageSelector?l.ngcsMessageSelector:".chat-message";return t.$watch(function(){return r[0].querySelectorAll(e).length},function(r,l){r>0&&t.$evalAsync(function(){t.ngcsLimit===r&&(t.ngcsNumRendered=r,(void 0).chatScroller.stopCurrentScroll())})})}}}])}();